<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="author" content="IntPtr" />
        <title>俄罗斯方块吧导航</title>
        <script type="text/javascript" src="libs/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="libs/showdown.js"></script>
        <script type="text/javascript">
            $(function(){
                var list=null;
                var left=$("#left-inner");
                var main=$("#main-inner");
                var as=null;
                var datas={};
                var now="";
                $("body").on("click","a",function(e){
                    var a=$(e.target);
                    var data=a.attr("data");
                    if(data){
                        load(data);
                    }else{
                        window.open(a.attr("href"),"_blank");
                    }
                    e.preventDefault();
                });
                function convert(str){
                    str=str.replace(/\|([^|]*?)\|/g,"<span class='hidden'>$1</span>");
                    str=str.replace(/\[\[\[(.*?)\]\]\]/,"<span class='black'>$1</span>");
                    return str;
                }
                function get_html(json,str){
                    var html="<ul>";
                    var data;
                    for(var i=0;i<json.list.length;i++){
                        data=json.data[json.list[i]];
                        html+="<li>";
                        if(data.url){
                            html+="<p><a href='#' data='"+(str?str+".":"")+json.list[i]+"'>"+convert(data.name)+"</a></p>";
                        }else{
                            html+="<p>"+convert(data.name)+"</p>";
                        }
                        if(data.data && data.list){
                            html+=get_html(data,json.list[i]);
                        }
                        html+="</li>";
                    }
                    html+="</ul>";
                    return html;
                }
                function get_data(str){
                    var l=str.split(".");
                    var t=list;
                    for(var i=0;i<l.length;i++){
                        if(!(t=t.data[l[i]])){
                            return null;
                        }
                    }
                    return t;
                }
                function load(name){
                    if(now!=name){
                        var data=get_data(name);
                        if(data){
                            if(datas[name]){
                                main.html(datas[name]);
                            }else{
                                $.get(data.url,function(md){
                                    datas[name]=convert((new Showdown.converter()).makeHtml(md));
                                    main.html(datas[name]);
                                });
                            }
                            now=name;
                            window.location.hash="#!"+name;
                            as.removeClass("on");
                            as.filter("a[data="+name.replace(/\./g,"\\.")+"]").addClass("on");
                        }
                    }
                }
                $.getJSON("main.json",function(json){
                    list=json;
                    left.html(get_html(list));
                    as=left.find("a");
                    var hash=window.location.hash.replace(/^#!/,"");
                    if(hash){
                        load(hash);
                    }else{
                        load("home");
                    }
                });
            });
        </script>
        <style type="text/css">
            *
            {
                margin: 0;
                padding: 0;
            }
            body,input,button,table,tr,td,th
            {
                font-family: Arial,sans-serif;
                font-size: 16px;
                line-height: 20px;
            }
            a
            {
                text-decoration: none;
            }
            a:link,a:visited,a:hover,a:active
            {
                color: #0000ff;
            }
            ul,ol
            {
                padding-left: 40px;
            }
            hr
            {
                margin: 10px 0;
            }
            h1,h2,h3,h4,h5,h6
            {
                margin: 10px 0;
            }
            p,table
            {
                margin: 5px 0;
            }
            h1
            {
                font-size: 32px;
                line-height: 36px;
            }
            h2
            {
                font-size: 24px;
                line-height: 28px;
            }
            h3,h4,h5,h6
            {
                font-size: 16px;
            }
            html,body
            {
                width: 100%;
                height: 100%;
            }
            .hidden
            {
                display: none;
            }
            .black
            {
                background-color: black;
            }
            #container
            {
                padding: 10px;
            }
            #header
            {
                padding: 10px;
                border: 1px solid black;
                font-size: 32px;
                font-weight: bolder;
            }
            #cols
            {
                zoom: 1;
                overflow: hidden;
            }
            #main-col
            {
                float: left;
                width: 100%;
            }
            #main-warp
            {
                margin-left: 250px;
            }
            #main
            {
                border-left: 1px solid black;
                border-right: 1px solid black;
                padding-bottom: 9999px;
                margin-bottom: -9999px;
                overflow: hidden;
            }
            #main-inner
            {
                padding: 10px;
            }
            #left-col
            {
                width: 250px;
                margin-left: -100%;
                float: left;
            }
            #left
            {
                border-left: 1px solid black;
                padding-bottom: 9999px;
                margin-bottom: -9999px;
                overflow: hidden;
            }
            #left-inner
            {
                padding: 10px;
            }
            #left-inner a.on
            {
                font-weight: bolder;
                color: black;
                cursor: default;
                text-decoration: none;
            }
            #footer
            {
                padding: 10px;
                border: 1px solid black;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <div id="header">
                俄罗斯方块吧导航
            </div>
            <div id="cols">
                <div id="main-col">
                    <div id="main-warp">
                        <div id="main">
                            <div id="main-inner"></div>
                        </div>
                    </div>
                </div>
                <div id="left-col">
                    <div id="left">
                        <div id="left-inner"></div>
                    </div>
                </div>
            </div>
            <div id="footer">
                Copyright &copy;2013 IntPtr All rights reserved
            </div>
        </div>
    </body>
</html>